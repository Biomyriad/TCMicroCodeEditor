<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>MicroCode Editor</title>
  <link rel="stylesheet" href="styles.css">
  <script src="main.js"></script>
  <script src="opCodeListbox.js" defer></script>
  <script src="ctrlLineListbox.js" defer></script>
  <script src="mStateListbox.js" defer></script>
  <script src="ctrlLineStateListbox.js" defer></script>
  <script src="saveLoadFileData.js" defer></script>
  <script src="export.js"></script>
  <!-- started 6-22-24 -->
  <style>
    
    
  </style>

</head>
<body onload="initApp()">
  <div id="option-bar">
    <div>
      <label>State:</label>
      <button onclick="saveStateToFile()">Save</button>
      <button onclick="loadStateFromFile()">Load</button>
    </div>
    <div>
      <label>Export to bin:</label>
      <button>Save</button>
    </div>
  </div>
  
  <div style="margin-bottom: 20px; margin-top: 20px;">
    <button onclick="TEST()" style="width: 57px; height: 57px; margin-right: 30px;">TEST</button>
    <button onclick="TEST2()" style="width: 57px; height: 57px;">TEST2</button>
  </div>
  
  
  <div id="content">
    <div>   <!-- OP Code List -->
      <div class="scroll-box" id="opcode-listbox"></div>
      <div style="margin-bottom: 5px;">
        <input type="text" id="new-op-code" style="width: 47px;" autocomplete="off">
        <input type="text" id="new-op-mnem" style="width: 125PX;" autocomplete="off">
        <input type="text" id="update-op-code" style="width: 47px;" autocomplete="off">
      </div>
      <div style="display: flex; justify-content: center; gap: 5px">
        <button onclick="opCodeLB.saveEntry()" style="width: 57px;">Save</button>
        <button onclick="opCodeLB.deleteEntry()" style="width: 57px;">Delete</button>
      </div>    
    </div>
    
    <div>
      <div class="scroll-box" id="opcode-statelist"></div>
      <div style="display: flex; justify-content: center; gap: 5px;">
        <button onclick="mStateLB.addState()">Add</button>
        <button onclick="mStateLB.removeState()">Remove</button>
      </div>
    </div>
  </div>
  
  <div id="popup">
    <div class="scroll-box" id="ctrllines-available"></div>
    <div class="" id="ctrllines-controls">
      <div id="ctrlform">
        <input type="text" id="ctrlform-bit" placeholder="Bit">
        <input type="text" id="ctrlform-name" placeholder="Name">
        <input type="text" id="ctrlform-group" placeholder="Group">
        <input type="text" id="ctrlform-overridecolor" placeholder="color">
        <div style="display: flex; justify-content: center; gap: 5px;">
          <button onclick="ctrlLineLB.saveEntry()">Save</button>
          <button onclick="ctrlLineLB.deleteEntry()">Delete</button>
        </div>
      </div>
      <div id="actionCtrls">
        <button onclick="ctrlLineStateLB.addCtrlToOpState()">=></button>
        <button onclick="ctrlLineStateLB.removeCtrlFromOpState()"><=</button>
        <button onclick="ctrlLineStateLB.deselectCtrl()">deSel</button>
      </div>
    </div>
    <div class="scroll-box" id="ctrllines-selected"></div>
  </div>
  
  <div>
    <button style="display: block; margin-bottom: 10px;" onclick='navigator.clipboard.writeText(document.getElementById("exportText").value)'>Copy</button>
    <textarea id="exportText"></textarea>
  </div>

  <script>



    
    // --------- ONLOAD ------------
    function initApp() {
      loadState()
      opCodeLB.refresh()
      ctrlLineLB.refresh()
    }
    
//---------- TEST FUNCTIONS ---------

    function TEST() {
      let res = exportData()
      let stats = getStats()

      let newOut = []
      let hldr = []
      for(let x=0;x<=stats.maxOpCode;x++) {
        for(let y=0;y<stats.maxStates;y++) {
          hldr = []
          for(let z=stats.numBytes-1;z>-1;z--) {
            let opOff = x*stats.maxStates*stats.numBytes
            let stateOff = y*stats.numBytes
            hldr.push(res[opOff+stateOff+z])
          }
          newOut.push('0x'+toHexString(hldr))
        }
      }

      let txtOut = document.getElementById('exportText')
      let txtHldr = ''
      for(let i=0;i<newOut.length;i++) {
        txtHldr = txtHldr + newOut[i] + ' '
        if((i+1) % 2 == 0 ) txtHldr = txtHldr + '\n'
      }
      txtOut.innerHTML  = txtHldr
    }
    
    function TEST2() {
      //localStorage.clear()
    }
    
  </script>

</body>
</html>